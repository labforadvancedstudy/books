# Foreign Function Interface (FFI)

## Core Insight
FFI enables Rust to call C functions and be called from C, providing zero-cost interoperability with existing system libraries.

```rust
// Calling C from Rust
extern "C" {
    fn strlen(s: *const c_char) -> size_t;
}

let c_str = CString::new("Hello").unwrap();
let len = unsafe { strlen(c_str.as_ptr()) };

// Exposing Rust to C
#[no_mangle]
pub extern "C" fn rust_function(x: i32) -> i32 {
    x * 2
}
```

FFI types mapping:
```rust
// C type -> Rust type
// char    -> c_char (i8 or u8)
// int     -> c_int (i32 usually)
// void*   -> *mut c_void
// char*   -> *const c_char
```

Bindgen for automatic bindings:
```rust
// build.rs
bindgen::Builder::default()
    .header("wrapper.h")
    .generate()
    .write_to_file("bindings.rs");
```

Safety concerns:
- Memory ownership unclear
- No null safety
- No thread safety guarantees
- ABI compatibility required
- Panics must not cross FFI boundary

FFI is the bridge to C ecosystem, requiring careful unsafe code.

## Connections
← [[021_unsafe_rust]]
← [[060_raw_pointers]]
→ [[127_cbindgen]]
→ [[128_abi_stability]]

---
Level: L5
Date: 2025-08-15
Tags: #ffi #c-interop #unsafe #foreign